"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[871],{81871:(e,t,o)=>{o.r(t),o.d(t,{GooglelocatorInit:()=>s});var n=o(88300),i=o(59718);class s{_init(){this._initVars(),this._initLogic()}_initVars(){this._optionsDefault=n.Xt.merge([this.constructor.optionsDefault,n.Xt.options[this.componentName]]),this._optionsInitial=this.options=n.Xt.merge([this._optionsDefault,this._optionsCustom])}_initLogic(){let e=this,t=e.options;e.ns=e.ns??n.Xt.uniqueId(),e.enable(),n.Xt._initMatches({self:e,optionsInitial:e._optionsInitial}),e.initial=!0,e.loaderElement=e.container.querySelector(t.elements.loader),e.itemsTemplate=e.container.querySelector(t.elements.itemsTemplate),e.itemsContainer=e.container.querySelector(t.elements.itemsContainer),e.foundElement=e.container.querySelector(t.elements.resultsFound),e.mapElement=e.container.querySelector(t.elements.map),e.map=new google.maps.Map(e.mapElement,t.map),e.autosuggestContainer=e.container.querySelector(t.elements.autosuggestContainer),e.autosuggestTemplate=e.container.querySelector(t.elements.autosuggestTemplate),e.searchInput=e.container.querySelector(t.elements.searchInput);let o=n.Xt.dataStorage.put(e.searchInput,`keypress/${e.ns}`,e._searchKeyboardEvent.bind(e));e.searchInput.addEventListener("keypress",o);let i=n.Xt.dataStorage.put(e.searchInput,`input focus/${e.ns}`,e._searchAutocompleteOn.bind(e));if(e.searchInput.addEventListener("input",i),e.searchInput.addEventListener("focus",i),e.autosuggestContainer){let t=n.Xt.dataStorage.put(e.container,`focusout/${e.ns}`,e._searchClose.bind(e));e.container.addEventListener("focusout",t)}e.searchBtn=e.container.querySelector(t.elements.searchBtn);let s=n.Xt.dataStorage.put(e.searchBtn,`click/${e.ns}`,e._searchClickEvent.bind(e));if(e.searchBtn.addEventListener("click",s),t.map.zoomMin&&google.maps.event.addListener(e.map,"zoom_changed",()=>{google.maps.event.addListener(e.map,"bounds_changed",()=>{e.map.getZoom()>t.map.zoomMin&&e.map.setZoom(t.map.zoomMin)})}),t.infoWindow&&(e.info=new google.maps.InfoWindow(t.infoWindow),google.maps.event.addListener(e.info,"closeclick",e._infoClose.bind(e))),t.elements.repeatBtn&&(e.repeatElement=e.container.querySelector(t.elements.repeatBtn),e.repeatElement)){let t=n.Xt.dataStorage.put(e.repeatElement,`click/${e.ns}`,e._submitCurrent.bind(e));e.repeatElement.addEventListener("click",t)}if(t.elements.locateBtn&&(e.locateElement=e.container.querySelector(t.elements.locateBtn),e.locateElement))if("https:"===location.protocol)if(navigator.geolocation){t.initialLocate&&e._locate({initial:!0});let o=n.Xt.dataStorage.put(e.locateElement,`click/${e.ns}`,e._locate.bind(e));e.locateElement.addEventListener("click",o)}else e.locateElement.style.display="none";else e.locateElement.style.display="none";e._initStart(),e.container.dispatchEvent(new CustomEvent(`setup.${e._componentNs}`)),n.Xt.frameDouble({el:e.container,ns:`${e.ns}Init`,func:()=>{e.container.setAttribute(`data-${e.componentName}-init`,""),e.container.dispatchEvent(new CustomEvent(`init.${e._componentNs}`)),e.initial=!1,t.debug&&console.debug(`${e.componentName} init`,e)}}),e.options.disabled&&e.disable()}_initStart(){let e=this,t=e.options;!e.disabled&&t.initialSearch&&google.maps.event.addListenerOnce(e.map,"idle",()=>{e.map.setCenter(t.map.center),e.map.setZoom(t.map.zoom),e._submitCurrent()})}async _searchAutocompleteOn(){let e=this,t=e.options;if(e._controller&&e._controller.abort(),e._controller=new AbortController,e._sessionToken||(e._sessionToken=new google.maps.places.AutocompleteSessionToken),""===e.searchInput.value.trim())return void e._searchAutocompleteOff();let{suggestions:o}=await google.maps.places.AutocompleteSuggestion.fetchAutocompleteSuggestions({input:e.searchInput.value,sessionToken:e._sessionToken,...e.options.autocompleteOptions});o.length?(e.autosuggestContainer.innerHTML="",e._searchAutocompleteOff(),n.Xt.on({el:e.autosuggestContainer}),o.forEach(o=>{if(o.placePrediction){let i=n.Xt.node({str:e.autosuggestTemplate.innerHTML});t.formatData.autosuggest(e,o,i),e.autosuggestContainer.append(i),i.querySelector(t.elements.autosuggestAction).addEventListener("click",()=>{e._searchAutocompleteOff(),e._searchSubmit({suggestion:o})});let s=n.Xt.dataStorage.put(document,`keydown/ariakeyboard/document/${e.ns}`,e._eventA11yDocumentKeydown.bind(e));document.removeEventListener("keydown",s),document.addEventListener("keydown",s)}})):e._searchAutocompleteOff()}_searchAutocompleteOff(){n.Xt.off({el:this.autosuggestContainer});let e=n.Xt.dataStorage.get(document,`keydown/ariakeyboard/document/${this.ns}`);document.removeEventListener("keydown",e)}async _searchSubmit(){let{suggestion:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.options;if(this.disabled)return;let{place:o}=await e.placePrediction.toPlace().fetchFields({fields:["displayName","location","viewport","formattedAddress"]});this.searchInput.value=e.placePrediction.text.text,o&&o.displayName&&""!==o.displayName&&o.location&&(this.position=o.location,this.viewport=o.viewport,this.radius=t.searchRadius,this.submit())}_searchClose(e){let t=this;setTimeout(()=>{(null==e?void 0:e.relatedTarget)&&t.container.contains(e.relatedTarget)||t._searchAutocompleteOff()},0)}_searchKeyboardEvent(e){let t=this.options;this.disabled||"Enter"===e.key&&(e.preventDefault(),this.searchInput.blur(),""===this.searchInput.value?(this.map.setCenter(t.map.center),this.map.setZoom(t.map.zoom),this._submitCurrent({empty:!0})):this._searchFirst())}_searchClickEvent(e){let t=this.options;this.disabled||(e.preventDefault(),""===this.searchInput.value?(this.map.setCenter(t.map.center),this.map.setZoom(t.map.zoom),this._submitCurrent({empty:!0})):this._searchFirst())}_searchFirst(){let e=this.options;this._searchClose();let t=this.autosuggestContainer.querySelector(e.elements.autosuggestAction);if(t)return void t.click();if(this._locateCache&&this._locateCache.value===this.searchInput.value){this.position=this._locateCache.position,this.viewport=null,this.radius=e.searchRadius,this.submit();return}this.locations=[],this._populateItems(),this.container.classList.add("noplace"),this.container.classList.remove("empty"),this.container.classList.remove("found"),this.container.classList.remove("error")}submit(){let e=this.options;this.disabled||(this._loaderShow(),setTimeout(this.submitDeferred.bind(this),e.submitDelay))}submitDeferred(){let e=this,t=e.options;if(!e.map.getBounds())return google.maps.event.addListenerOnce(e.map,"bounds_changed",()=>{e.submit()}),!1;e.filters=e.container.querySelectorAll(t.elements.filter),e.locations=[];let o=0,s=t.markers,a=new google.maps.LatLngBounds;for(let n of s)if(!e.filters.length||e._filterMarker({marker:n})){let i=new google.maps.LatLng(t.formatData.lat?t.formatData.lat(e,n):n.lat,t.formatData.lng?t.formatData.lng(e,n):n.lng),s=google.maps.geometry.spherical.computeDistanceBetween(e.position,i);if(!e.radius&&!e.viewport||e.radius&&s<=e.radius||e.viewport&&e.viewport.contains(i)){let r,l=n.icon||t.map.icon;l&&((r=document.createElement("img")).src=l);let c=new google.maps.marker.AdvancedMarkerElement({map:e.map,position:i,title:n.name,content:r});c.animation=n.animation||t.map.animation,c.distance=s,c.marker=n,c.index=o,a.extend(i),e.locations.push(c),c.addListener("click",()=>{e._populateInfo({loc:c,type:"marker"})}),o++}}for(let[t,o]of e.locations.entries())o.index=t;t.formatData.sort(e),e._populateItems(),t.map.cluster&&(e.cluster&&e.cluster.clearMarkers(),e.cluster=new i.w1({map:e.map,markers:e.locations,...t.map.cluster})),e._loaderHide(),e.locations.length?(e.container.classList.remove("noplace"),e.container.classList.remove("empty"),e.container.classList.add("found"),e.container.classList.remove("error"),e.foundElement&&(e.foundElement.innerHTML=e.locations.length),e.map.fitBounds(a),e.map.panToBounds(a)):(e.container.classList.remove("noplace"),e.container.classList.add("empty"),e.container.classList.remove("found"),e.container.classList.remove("error"),e.viewport&&(e.map.fitBounds(e.viewport),e.map.panToBounds(e.viewport))),t.debug&&console.debug("xt-googlelocator locations",e.locations),n.Xt.frame({el:e.container,ns:`${e.ns}Change`,func:()=>{e.container.dispatchEvent(new CustomEvent(`change.${e._componentNs}`))}})}_populateItems(){for(let e of this.container.querySelectorAll(".xt-googlelocator-clone"))e.remove();for(let e of this.locations)this._populateItem({loc:e})}_filterMarker(){let{marker:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.options.formatData.filter(this,e,this.filters)}_populateItem(){let{loc:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this,o=t.options,i=document.createElement("div");for(let s of(i.innerHTML=n.Xt.sanitize(t.itemsTemplate.innerHTML),(i=i.querySelector(":scope > *")).classList.add("xt-googlelocator-clone"),i.setAttribute("data-xt-index",e.index.toString()),t.itemsContainer.append(i),i.querySelectorAll("[data-xt-populate]"))){let n=o.formatData[s.getAttribute("data-xt-populate")];n&&n(t,e,s)}i.addEventListener("click",()=>{t._populateInfo({loc:e,type:"result"})})}_populateInfo(){let{loc:e,type:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=this.options;this._animatingLoc&&(this._animatingLoc.setAnimation(null),this._animatingLoc=null);let i="marker"===t?o.events.animateMarkerClick:"result"===t?o.events.animateMarkerResultClick:null;i&&(e.setAnimation(i),this._animatingLoc=e);let s=this.itemsContainer.querySelector(`[data-xt-index="${e.index}"]`);if(this._infoClose(),s&&(s.focus(),n.Xt.on({el:s})),o.infoWindow)if("marker"===t?o.events.infoWindowMarkerClick:"result"===t?o.events.infoWindowMarkerResultClick:null){if(s){let t=o.formatData.info(this,e,s);t&&(this.info.setContent(t),this.info.open(this.map,e))}}else this.info.close(this.map)}_infoClose(){let e=this.itemsContainer.querySelector("[data-xt-index].on");e&&n.Xt.off({el:e})}_submitCurrent(){let{empty:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.options;this.searchInput.value="",this.position=this.map.getCenter(),this.viewport=null,(!e||t.seachMapBounds)&&(this.radius=google.maps.geometry.spherical.computeDistanceBetween(this.position,this.map.getBounds().getNorthEast())),this.submit()}_locate(){let{initial:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.disabled||(e||this._loaderShow(),window.navigator.geolocation.getCurrentPosition(this._locateSuccess.bind(this),this._locateError.bind(this)))}_locateSuccess(e){let t=this.options;this._loaderHide(),this.searchInput.value=t.locateText,this.position=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),this.viewport=null,this.radius=t.searchRadius,this._locateCache={value:this.searchInput.value,position:this.position},t.debug&&console.debug("xt-googlelocator locate",e,this.position),this.map.setCenter(this.position),this.submit()}_locateError(e){this._loaderHide(),console.error("Error: Xt.Googlelocator locate error",e)}_loaderShow(){n.Xt.on({el:this.loaderElement})}_loaderHide(){n.Xt.off({el:this.loaderElement})}_eventA11yDocumentKeydown(e){let t=this.options;if(this.disabled)return;let o=e.key,n=t.a11y.vertical?"ArrowLeft":"ArrowUp",i=t.a11y.vertical?"ArrowRight":"ArrowDown";if(t.a11y.items){let s,a=[];if(a.push(...this.autosuggestContainer.querySelectorAll(t.a11y.items)),a.length){let t=a.indexOf(document.activeElement);if(o===n){if(-1===t)s=a[a.length-1];else{let e=(t-1+a.length)%a.length;s=a[e]}e.preventDefault()}else if(o===i){if(-1===t)s=a[0];else{let e=(t+1)%a.length;s=a[e]}e.preventDefault()}if(s)return void s.focus()}}}enable(){this.disabled&&(this.disabled=!1,this.container.dispatchEvent(new CustomEvent(`status.${this._componentNs}`)))}disable(){let{skipEvent:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!this.disabled&&(this.disabled=!0,e||this.container.dispatchEvent(new CustomEvent(`status.${this._componentNs}`)))}reinit(){this._initLogic()}destroy(){let e=this.options,t=n.Xt.dataStorage.get(this.searchInput,`keypress/${this.ns}`);this.searchInput.removeEventListener("keypress",t);let o=n.Xt.dataStorage.get(this.searchInput,`input focus/${this.ns}`);this.searchInput.removeEventListener("input",o),this.searchInput.removeEventListener("focus",o);let i=n.Xt.dataStorage.get(this.container,`focusout/${this.ns}`);this.container.removeEventListener("focusout",i);let s=n.Xt.dataStorage.get(this.searchBtn,`click/${this.ns}`);if(this.searchBtn.removeEventListener("click",s),this.locateElement){let e=n.Xt.dataStorage.get(this.locateElement,`click/${this.ns}`);this.locateElement.removeEventListener("click",e)}if(this.repeatElement){let e=n.Xt.dataStorage.get(this.repeatElement,`click/${this.ns}`);this.repeatElement.removeEventListener("click",e)}if(e.infoWindow&&google.maps.event.removeListener(this.info,"closeclick",this._infoClose.bind(this)),e.elements.locateBtn&&(this.locateElement=this.container.querySelector(e.elements.locateBtn),this.locateElement&&"https:"===location.protocol&&navigator.geolocation)){let e=n.Xt.dataStorage.put(this.locateElement,`click/${this.ns}`,this._locate.bind(this));this.locateElement.removeEventListener("click",e)}for(let e of(this.container.classList.remove("noplace"),this.container.classList.remove("empty"),this.container.classList.remove("found"),this.container.classList.remove("error"),this.container.querySelectorAll(".xt-googlelocator-clone")))e.remove();this.container.removeAttribute(`data-${this.componentName}-init`),n.Xt._remove({name:this.componentName,el:this.container}),this.container.dispatchEvent(new CustomEvent(`destroy.${this._componentNs}`)),delete this}}}}]);