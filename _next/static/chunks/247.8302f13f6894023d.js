"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[247],{4247:(t,e,i)=>{i.r(e),i.d(e,{InfinitescrollInit:()=>o});var n=i(88300);class o{_init(){this._initVars(),this._initLogic()}_initVars(){this._optionsDefault=n.Xt.merge([this.constructor.optionsDefault,n.Xt.options[this.componentName]]),this._optionsInitial=this.options=n.Xt.merge([this._optionsDefault,this._optionsCustom]);let t=this.options;this.current=Math.floor(t.min/t.perPage),t.get||(this._itemsFake=this.container.querySelector(t.elements.itemsContainer).cloneNode(!0))}_initLogic(){var t;let e=this,i=e.options;e.ns=e.ns??n.Xt.uniqueId(),e.enable(),n.Xt._initMatches({self:e,optionsInitial:e._optionsInitial}),e.initial=!0,e.scrollUp=e.container.querySelectorAll(i.elements.scrollUp),e.scrollDown=e.container.querySelectorAll(i.elements.scrollDown),e.itemsContainer=e.container.querySelector(i.elements.itemsContainer),e.spaceAdditionals=e.container.querySelectorAll(i.elements.spaceAdditional),e.paginations=e.container.querySelectorAll(i.elements.pagination),i.nocache&&addEventListener("beforeunload",n.Xt.dataStorage.put(window,`beforeunload/${e.ns}`,e._eventBeforeunload.bind(e))),addEventListener("scroll",n.Xt.dataStorage.put(window,`scroll/${e.ns}`,e._eventScroll.bind(e)));let o=(null==(t=i.events)?void 0:t.on)?i.events.on.split(" "):[];if(o.length)for(let t of[...Array.from(e.scrollUp),...Array.from(e.scrollDown)]){let s=n.Xt.dataStorage.put(t,`${i.events.on}/${e.ns}`,e._eventTrigger.bind(e,{trigger:t}));for(let e of o)t.addEventListener(e,s)}e._initStart(),e.container.dispatchEvent(new CustomEvent(`setup.${e._componentNs}`)),n.Xt.frameDouble({el:e.container,func:()=>{e.container.setAttribute(`data-${e.componentName}-init`,""),e.container.dispatchEvent(new CustomEvent(`init.${e._componentNs}`)),e.initial=!1,i.debug&&console.debug(`${e.componentName} init`,e)},ns:`${e.ns}Init`}),e.options.disabled&&e.disable()}_initStart(){let t=this,e=t.options;if(!t.disabled){if(t._setCurrent(),t._update(),t._paginate(),t._prefetch(),t.itemsContainer){let i=t.itemsContainer.querySelector(e.elements.item);i&&i.setAttribute("data-item-first",t.current)}if(e.nocache){let i=t._additionalSpace(),o=history.state;o&&o[`scrollResume${t._componentNs}`]&&n.Xt.ready({state:"complete",func:()=>{requestAnimationFrame(()=>{let n=t.itemsContainer.querySelector(e.elements.item);document.scrollingElement.scrollTop=o[`scrollResume${t._componentNs}`]+n.offsetTop+i})}})}}}_eventTrigger(){let{trigger:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this,i=e.options;if(e.disabled)return;let o=parseFloat(t.getAttribute("data-xt-infinitescroll-up")),s=parseFloat(t.getAttribute("data-xt-infinitescroll-down")),r=o||s;if(r){let i=e._getNext({amount:r}),s=e.itemsContainer.querySelector(`[data-item-first="${i}"]`);i!==e.current&&!s&&(e._setCurrent({page:i}),e.inverse=!!o,e.container.classList.contains("xt-infinitescroll-loading")||(e.container.classList.add("xt-infinitescroll-loading"),n.Xt.perf({func:()=>{e._request(),e._prefetch({trigger:t})}})))}else e._setCurrent({page:Math.floor(i.min/i.perPage)}),location=e._url.href}_getNext(){let{amount:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.options,i=this.current+t,n=Math.floor(e.min/e.perPage),o=Math.ceil(e.max/e.perPage);return(i=i<n?n:i)>o?o:i}_eventBeforeunload(){if(!this.disabled&&this._scrollResume){let t={};t[`scrollResume${this._componentNs}`]=this._scrollResume,history.replaceState(t,"",this._url.href)}}_eventScroll(){var t;let e=this.options;if(this.disabled||this._loading)return;let i=document.scrollingElement.scrollTop,o=window.innerHeight,s=Array.from(this.itemsContainer.querySelectorAll("[data-item-first]")).reverse(),r=s[s.length-1];for(let t of s)if(t.getBoundingClientRect().top<o/2){r=t;break}if(this._setCurrent({page:parseFloat(r.getAttribute("data-item-first"))}),this._paginate(),e.nocache){let t=this._additionalSpace();this._scrollResume=i-r.offsetTop-t}let l=this._url.origin||`${this._url.protocol}//${this._url.host}`;if(l===location.origin?this._url.href!==location.href&&history.replaceState(null,"",this._url.href):console.error("Error: Xt.Infinitescroll cannot set history with different origin",l),((null==(t=e.events)?void 0:t.on)?e.events.on.split(" "):[]).length){if(e.events.scrollUp&&this._scrollTopOld>i)for(let t of this.scrollUp)i<t.offsetTop&&n.Xt.dataStorage.get(t,`${e.events.on}/${this.ns}`)({target:t});if(e.events.scrollDown&&this._scrollTopOld<=i)for(let t of this.scrollDown)i+o>t.offsetTop+t.offsetHeight&&n.Xt.dataStorage.get(t,`${e.events.on}/${this.ns}`)({target:t})}this._scrollTopOld=i}_request(){let t=this;t._loading=!0,fetch(t._url.href,{method:"GET"}).then(t=>t.ok?t.text():Promise.reject(t)).then(e=>{t._success({text:e})}).catch(()=>{t._error()})}_success(){let{text:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this,i=e.options,n=document.createElement("html");n.innerHTML=t,e.loadedHtml=n;let o=n.querySelector(i.elements.itemsContainer);i.get&&o?(e._loading=!1,e._populate({itemsContainer:o})):setTimeout(()=>{e._loading=!1,e._populate({itemsContainer:e._itemsFake.cloneNode(!0)})},1e3)}_error(){this._loading=!1,this.container.classList.remove("xt-infinitescroll-loading")}_populate(){let{itemsContainer:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this,i=e.options,o=t.querySelectorAll(i.elements.item);o[0].setAttribute("data-item-first",e.current),n.Xt.perf({func:()=>{var t;null==(t=o[0].querySelector("input, select, textarea, button, object, a, area[href], [tabindex]"))||t.focus()}});let s=e.itemsContainer.querySelectorAll(`${i.elements.item}`);for(let t of o)if(e.inverse)s[0].before(t);else{let n=e.itemsContainer.querySelectorAll(`${i.elements.item}`);n[n.length-1].after(t)}e.container.classList.remove("xt-infinitescroll-loading"),e._update(),e._paginate(),e._eventScroll(),n.Xt.frame({el:e.container,ns:`${e.ns}Populate`,func:()=>{e.container.dispatchEvent(new CustomEvent(`populate.${e._componentNs}`))}})}_paginate(){let t=this.options;for(let e of this.paginations)if(!e.dataset.current||this.current>parseFloat(e.dataset.current)){e.dataset.current=this.current,e.dataset.html=e.dataset.html?e.dataset.html:e.innerHTML;let i=e.dataset.html,o=/xt-num/gi;if(-1!==i.search(o)){let e=this.current*t.perPage;e=e>t.max?t.max:e,i=i.replace(o,e)}o=/xt-tot/gi,-1!==i.search(o)&&(i=i.replace(o,t.max)),e.innerHTML=n.Xt.sanitize(i)}}_update(){let t=this.options;this.current<=Math.floor(t.min/t.perPage)&&this.container.classList.add("xt-infinitescroll-first"),this.current>=Math.ceil(t.max/t.perPage)&&this.container.classList.add("xt-infinitescroll-last")}enable(){this.disabled&&(this.disabled=!1,this.container.dispatchEvent(new CustomEvent(`status.${this._componentNs}`)))}disable(){let{skipEvent:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!this.disabled&&(this.disabled=!0,t||this.container.dispatchEvent(new CustomEvent(`status.${this._componentNs}`)))}_additionalSpace(){let t=0;for(let e of this.spaceAdditionals)t+=e.offsetHeight;return t}_setCurrent(){let{page:t=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.options,i=new URL(location.href),n=new URLSearchParams(i.search),o=n.get(e.get);this.current=null!==t?t:o?parseFloat(o):this.current,n.set(e.get,this.current),i.search=n.toString(),this._url=i}_prefetch(){let{trigger:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.options;if(e.prefetch)for(let i of t?[t]:[...Array.from(this.scrollUp),...Array.from(this.scrollDown)]){let t=parseFloat(i.getAttribute("data-xt-infinitescroll-up")),n=parseFloat(i.getAttribute("data-xt-infinitescroll-down")),o=t||n,s=new URL(location.href),r=new URLSearchParams(s.search),l=this._getNext({amount:o});if(this.current!==l){r.set(e.get,l),s.search=r.toString();let t=document.createElement("link");t.rel="prefetch",t.href=s,t.as="fetch",document.head.appendChild(t)}}}reinit(){this._initLogic()}destroy(){let t=this.options;for(let e of(t.nocache&&removeEventListener("beforeunload",n.Xt.dataStorage.get(window,`beforeunload/${this.ns}`)),removeEventListener("scroll",n.Xt.dataStorage.get(window,`scroll/${this.ns}`)),[...Array.from(this.scrollUp),...Array.from(this.scrollDown)])){let i=n.Xt.dataStorage.get(e,`${t.events.on}/${this.ns}`);e.removeEventListener(t.events.on,i)}this.container.removeAttribute(`data-${this.componentName}-init`),n.Xt._remove({name:this.componentName,el:this.container}),this.container.dispatchEvent(new CustomEvent(`destroy.${this._componentNs}`)),delete this}}}}]);